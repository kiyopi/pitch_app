# 採点システム調整ドキュメント

## 概要
ユーザーエクスペリエンス向上とマイク性能・環境要因への配慮から、採点システムの調整を実施しました。

## 調整の背景

### 問題認識
1. **厳しすぎる判定基準**: 要練習判定が多発し、ユーザーのモチベーション低下
2. **環境要因の影響**: マイク性能や周囲のノイズが判定結果に過度に影響
3. **ペナルティシステムの厳格さ**: 少数の外れ値で大幅な評価降格

### 具体的な課題
- 8音中6音（75%）の高精度が要求される厳しい基準
- ±15セント（優秀）、±25セント（良好）の狭い許容範囲
- Level3外れ値1個で良好→要練習への降格

## 実施した調整

### 2025-07-13: 第1段階調整（音程判定の緩和）

#### 1. 音程判定の閾値緩和（全体的緩和）
```javascript
// 調整前
perfect: 15,    // ±15セント以内で優秀
good: 25,       // ±25セント以内で良好
acceptable: 40, // ±40セント以内で合格
outlier: 50     // ±50セント超で外れ値

// 調整後
perfect: 20,    // ±20セント以内で優秀（+5セント緩和）
good: 35,       // ±35セント以内で良好（+10セント緩和）
acceptable: 50, // ±50セント以内で合格（+10セント緩和）
outlier: 80     // ±80セント超で外れ値（+30セント緩和）
```

#### 2. 基本採点の必要音数調整（選択的緩和）
```javascript
// 優秀判定: 8音中6音（75%）← 現状維持（厳格さ保持）
if (excellentCount >= 6) {
    overallGrade = '🏆 優秀！';
}

// 良好判定: 8音中5音（62.5%）← 6音から緩和（12.5%ポイント緩和）
else if (passableCount >= 5) {
    overallGrade = '🎉 良好！';
}
```

### 2025-07-13: 第2段階調整（ペナルティ条件の緩和）

### 2025-07-13: 第3段階調整（外れ値閾値の最終調整）

#### 外れ値判定閾値の緩和

**調整の背景**:
- マイク性能や環境ノイズへのさらなる配慮
- 音楽理論的に妥当な「音痴」レベルの設定
- 半音（100セント）の80%という適切なバランス

**調整内容**:
```javascript
// 外れ値判定閾値の調整
// 調整前
outlier: 70     // ±70セント超で外れ値

// 調整後  
outlier: 80     // ±80セント超で外れ値（+10セント緩和）
```

**音楽教育的妥当性**:
- **半音の80%**: 明らかに練習が必要だが過度に厳格ではない
- **環境要因への配慮**: マイク品質やノイズによる一時的なずれに寛容
- **国際基準との整合**: 一般的な音楽教育での「要改善」レベル

#### ペナルティ適用条件の見直し

**調整の背景**:
- 1個の外れ値による過度な評価降格
- 環境要因（マイク性能、ノイズ）への配慮不足
- ユーザーの納得感向上が必要

**調整内容**:
```javascript
// 良好→要練習への降格条件

// 調整前（厳格版）
condition: (outlierAnalysis) => {
    return outlierAnalysis.summary.level1 >= 2 ||  // Level1: 2個以上
           outlierAnalysis.summary.level2 >= 1 ||  // Level2: 1個以上  
           outlierAnalysis.summary.level3 >= 1;    // Level3: 1個以上
}

// 調整後（緩和版）
condition: (outlierAnalysis) => {
    return outlierAnalysis.summary.level1 >= 3 ||  // Level1: 3個以上（2→3に緩和）
           outlierAnalysis.summary.level2 >= 2 ||  // Level2: 2個以上（1→2に緩和）
           outlierAnalysis.summary.level3 >= 2;    // Level3: 2個以上（1→2に緩和）
}
```

**外れ値レベルの定義**:
- **Level1（注意）**: 50-80セント（軽微な音程ずれ）
- **Level2（警告）**: 80-120セント（中程度の音程問題）
- **Level3（重大）**: 120セント以上（明らかな音程問題）

**音楽教育的妥当性**:
- **Level1**: 3個まで許容 → 軽微な問題は寛容に
- **Level2**: 2個まで許容 → 中程度の問題は適度に厳格
- **Level3**: 2個まで許容 → 重大な問題は緩和しつつ品質維持

## 調整の効果予測

### 優秀判定への影響
- **閾値緩和**: ±15セント → ±20セント（適度に取りやすく）
- **必要音数**: 6音維持（高水準を保持）
- **期待効果**: 質の高い演奏の適切な評価

### 良好判定への影響
- **閾値緩和**: ±25セント → ±35セント（大幅改善）
- **必要音数**: 6音 → 5音（達成しやすさ向上）
- **期待効果**: 一般ユーザーの達成感向上

### 要練習判定への影響
- **適用範囲縮小**: 本当に練習が必要な場合に限定
- **モチベーション向上**: 過度な厳格判定の回避

### ペナルティシステムへの影響
- **環境要因への対応**: 一時的な外れ値による過度な降格を防止
- **音楽的妥当性**: 複数の問題がある場合のみ降格適用
- **ユーザー満足度**: より納得感のある評価システム

## 音楽理論的妥当性

### 調整後の基準の妥当性
- **±20セント（優秀）**: プロフェッショナルレベルの高精度
- **±35セント（良好）**: 一般的な歌唱で「良好」とされる範囲
- **±50セント（合格）**: 音楽的に許容される基本範囲
- **±80セント（外れ値）**: 明らかに練習が必要なレベル

### 国際的な基準との比較
- **プロ歌手**: ±10-15セント
- **上級アマチュア**: ±20-30セント
- **一般的な歌唱**: ±30-50セント

調整後の基準は国際的な音楽教育基準と整合性があります。

## 技術的な実装詳細

### 変更ファイル
- `full-scale-training.js`: 閾値設定と基本採点ロジック

### 変更箇所
1. **Line 110-115**: `this.thresholds` 設定値の更新
2. **Line 1340-1350**: 基本採点の必要音数調整  
3. **Line 1535-1544**: ペナルティ適用条件の緩和
4. **Line 114**: 外れ値閾値の最終調整（70→80セント）
5. **Line 2089**: 判定結果の見方の更新

### 後方互換性
- 既存のペナルティシステムとの完全互換
- 段階的表示システムへの影響なし
- 外れ値分析ロジックとの整合性維持

## 今後の監視ポイント

### 短期的な確認事項（1-2週間）
1. ユーザーの評価分布の変化
2. 要練習判定の減少効果
3. 優秀・良好判定の適切なバランス

### 中期的な評価項目（1ヶ月）
1. ユーザー満足度の向上
2. 継続利用率への影響
3. 音楽的成長の促進効果

### 追加調整の可能性
- **ペナルティシステムの緩和**: Level3外れ値の条件見直し
- **環境補正機能**: マイク品質の自動検出と補正
- **適応的基準**: ユーザーレベルに応じた動的調整

## 関連ドキュメント
- [PITCH_DETECTION_FIX.md](./PITCH_DETECTION_FIX.md): 周波数検出システム修正
- [BRANCH_MANAGEMENT.md](./BRANCH_MANAGEMENT.md): 開発ブランチ管理

## 調整履歴

### 完了した調整
- ✅ **第1段階**: 音程判定の閾値緩和（基本的な許容範囲の拡大）
- ✅ **第2段階**: ペナルティ適用条件の緩和（必要音数とペナルティ条件の調整）
- ✅ **第3段階**: 外れ値閾値の最終調整（70→80セントで環境要因に配慮）

### 最終的な採点基準
```javascript
// 最終調整済み設定
this.thresholds = {
    perfect: 20,    // ±20セント以内で優秀
    good: 35,       // ±35セント以内で良好
    acceptable: 50, // ±50セント以内で合格
    outlier: 80     // ±80セント超で外れ値
};

// 基本採点必要音数
- 優秀判定: 8音中6音（75%）維持
- 良好判定: 8音中5音（62.5%）に緩和

// ペナルティ条件
- Level1外れ値: 3個以上で降格
- Level2外れ値: 2個以上で降格  
- Level3外れ値: 2個以上で降格
```

---
*作成日: 2025-07-13*  
*最終更新: 2025-07-13*  
*調整完了日: 2025-07-13*  
*次回レビュー予定: 2025-07-20*